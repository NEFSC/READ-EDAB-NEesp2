<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>General report creation workflow • NEesp2</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="General report creation workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">NEesp2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-about-esp" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">About ESP</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-about-esp">
<li><a class="dropdown-item" href="../articles/why-esp.html">Why ESP?</a></li>
    <li><a class="dropdown-item" href="../articles/indicator-sources.html">Indicator Sources for Northeast ESPs</a></li>
    <li><a class="dropdown-item" href="../articles/esp-links.html">Northeast ESP Links</a></li>
  </ul>
</li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/install-and-use-package.html">Install and Use Package</a></li>
    <li><a class="dropdown-item" href="../articles/general-workflow.html">General Workflow</a></li>
    <li><a class="dropdown-item" href="../articles/rmarkdown-intro.html">RMarkdown Intro</a></li>
    <li><a class="dropdown-item" href="../articles/using_edab_utils.html">Using EDAB-Utils R package</a></li>
    <li><a class="dropdown-item" href="../articles/accessing-survdat-data.html">Accessing Bottom Trawl Survey Data</a></li>
    <li><a class="dropdown-item" href="../articles/using_mrip_data.html">Using MRIP Data for Recreational Indicators</a></li>
    <li><a class="dropdown-item" href="../articles/using_survdat_data.html">Using {survdat} for Bottom Trawl Indicators</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Functions</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../mailto:stephanie.owen@noaa.gov"><span class="fa fas fa-paper-plane fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NEFSC/READ-EDAB-NEesp2/issues/"><span class="fa fas fa-question-circle fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/NEFSC/READ-EDAB-NEesp2"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://nmfs-general-modeling-tools.github.io/"><span class="fa fa-fish"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>General report creation workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/NEFSC/READ-EDAB-NEesp2/blob/HEAD/vignettes/general-workflow.Rmd" class="external-link"><code>vignettes/general-workflow.Rmd</code></a></small>
      <div class="d-none name"><code>general-workflow.Rmd</code></div>
    </div>

    
    
<p>The general workflow for report creation outlined can be leveraged in
other projects.</p>
<div class="section level2">
<h2 id="make-it-an-r-package">0. Make it an R package<a class="anchor" aria-label="anchor" href="#make-it-an-r-package"></a>
</h2>
<p>Even though it seems more complicated from the outset, creating your
report workflow as an R package will save time and streamline your final
product in the long run. When your reporting ecosystem inhabits its own
R package, it can be easily accessed by people (including you). To
create an R package, start a new R project, and then run
<code><a href="https://usethis.r-lib.org/reference/create_package.html" class="external-link">usethis::create_package()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="data-curation">1. Data curation<a class="anchor" aria-label="anchor" href="#data-curation"></a>
</h2>
<p>The first step is to locate data. Data can come from a variety of
sources, including public websites, private databases, personal
correspondence, or existing R packages. Current data sources for the
<code>NEesp2</code> package include the <code>assessementdata</code>
package, the <code>survdat</code> package (<code>svdbs</code> database),
and MRIP recreational catch data.</p>
<p>After data has been located, it must be formatted correctly. It is
possible that the data is already in the correct format, but in many
cases some data cleaning will be required. It is strongly suggested to
put the data in a <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html" class="external-link">tidy
format</a>.</p>
<p>Depending on your data source, the data may or may not already have
species names and stock regions assigned. For example, some survey data
may have strata rather than stock region, or scientific name rather than
common name. You should format all of your data to conform to standard
species naming and region naming conventions.</p>
<p>Finally, once your data is properly formatted with standard species
and region names, you should save your data in your own R package. After
your data exists as an R object, you can save it to the package with:
<code>usethis::use_data({your data name})</code>. This will allow you to
access your data quickly and easily, without having to repeat any data
curation steps when you need to use your data.</p>
</div>
<div class="section level2">
<h2 id="write-functions">2. Write functions<a class="anchor" aria-label="anchor" href="#write-functions"></a>
</h2>
<p>After you have your data, the next step is to begin visualizing and
displaying it. I like to begin by creating a plot or table for one
species (or stock) only. Once I am happy with the look of the plot or
table, I generalize the creation code into a function that can be
applied to any input data. Finally, document the function and save it
into your package using the <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/roxygen2.html" class="external-link"><code>roxygen2</code>
package</a>.</p>
</div>
<div class="section level2">
<h2 id="make-your-report-template">3. Make your report template<a class="anchor" aria-label="anchor" href="#make-your-report-template"></a>
</h2>
<p>You can create your report template at the same time as you create
your functions. I recommend using the <a href="https://bookdown.org/yihui/bookdown/" class="external-link"><code>bookdown</code>
package</a> to create your template, because you can create each section
as its own RMarkdown file, which helps with organization.</p>
<p>I recommend that you give your template the ability to export and
save all of the data and figures used and produced by your report. This
isn’t required, but it makes it easier for the information from your
report to be used in other contexts. Data can be saved with a simple
call to <code>write.csv</code> or <code>saveRDS</code> (for large or
unwieldy data sets). Figures can be saved by setting the figure cache in
the global options, e.g., by running
<code>knitr::opts_chunk$set(fig.path = "...")</code> in your setup
chunk. Put two forward slashes (//) after the path name, or else the
figure names will be appended to the folder name, rather than placed in
the folder. Alternatively, you could also use
<code>png(...); ... ; dev.off()</code> to save a figure. If desired, you
can create an RMarkdown parameter to toggle data/figure saving on and
off.</p>
<p>If you find that your workflow necessitates frequently repeating the
same code chunk(s) or RMarkdown section(s) with different inputs,
consider making a child document that you can call instead. This will
streamline your code and reduce copy-and-paste errors. For example, the
<code>render_indicator</code> function use in the regression reports
calls a child document that is rendered with different indicator inputs
each time (inputs are assigned to generic names before
<code>render_indicator</code> is called).</p>
<p>Although it is not required, I strongly recommend that you create a
custom rendering function for your report template. This will allow you
to set default values and make the parameters that should be changed
more visible.</p>
<p>Your template should be saved in the <code>inst</code> folder of your
package (in its own folder, if it’s a bookdown). Files in the
<code>inst</code> folder are made available in the root directory of an
installed R package, so your package code can access the template files
by calling
<code>system.file("{your template name}", package = "{your package name}")</code></p>
</div>
<div class="section level2">
<h2 id="update-your-package-and-iterate">4. Update your package and iterate<a class="anchor" aria-label="anchor" href="#update-your-package-and-iterate"></a>
</h2>
<p>As you work on your report, update package functions and the report
template as needed. You will likely run into edge cases that have to be
handled, come up with more efficient code, and add new data as it
becomes available, among other updates.</p>
</div>
<div class="section level2">
<h2 id="deploy-a-suite-of-reports-using-github-actions">5. Deploy a suite of reports using Github Actions<a class="anchor" aria-label="anchor" href="#deploy-a-suite-of-reports-using-github-actions"></a>
</h2>
<p>If you are using your workflow to generate a large number of reports,
it is probably useful to offload the report generation onto a remote
runner with Github Actions. When you generate your reports with Github
Actions, you do not have to devote memory and time on your local machine
to report generation. However, there will likely be some hurdles when
getting Github Actions set up successfully. <a href="https://github.com/NOAA-EDAB/esp_data_aggregation/blob/main/.github/workflows/render_indicator_reports_dev.yaml" class="external-link">Here</a>
is a Github Action workflow that successfully renders reports and
deploys them to a different repository. The general steps in the
workflow are outlined below.</p>
<p>Github Actions is running your code in a remote environment, which
does not have anything pre-installed. That means you have to install R,
pandoc, and any packages you need. I have found that I also have to
configure some settings on the command line in bash to get all of the
packages I need to install correctly. You also have to check out your
repo to the remote environment.</p>
<p>Depending on the complexity of your reports, you may need several
dozen libraries, and the time it takes to install these libraries adds
up. To avoid the bottleneck of re-installing all of the libraries you
need every time you run your Github Action, you can cache your packages
by adding a cache step to your Github Actions workflow, which will save
the libraries in the remote environment and allow them to be loaded in
the remote environment without re-installing. As long as the cache is
accessed at least once a week, it will continue to live in the remote
environment. Therefore, I suggest making a cache-maintaining Github
Actions workflow that pings the cache on a regular schedule, so you
don’t have to re-create the cache every time you go a few weeks without
creating reports.</p>
<p>After rendering the reports in the remote environment, you must
deploy the reports to a repository on github.com, or else the Github
Action will end, the remote environment will be closed, and the reports
will be gone. Before being able to successfully deploy reports with
Github Actions, you must do some housekeeping to set yourself up with
the correct permissions. First, create a <strong>personal access
token</strong> by going to Settings –&gt; Developer settings –&gt;
Personal access tokens in your Github account. Write this token down and
save it somewhere, but do not share it with anyone. Next, go to your
repo where you are setting up the Github Actions workflow. Go to
Settings –&gt; Secrets and add the <strong>same token</strong> with the
<strong>same name</strong>. You must have a personal access token set up
in every repo where you are trying to deploy a Github Action.</p>
<p>One issue with deploying reports on Github Actions is that if one
step fails, all following steps in the Github Actions workflow are
canceled. This means that if your report rendering script breaks, no
reports will be deployed, even if the script breaks on the last report.
Depending on the complexity of your report, it may be common for an
untested edge case to break the code. Fortunately, there is a
work-around. If you wrap your render function in <code><a href="https://rdrr.io/r/base/try.html" class="external-link">try()</a></code>, the
script will execute even if some reports are not properly created. Of
course, the reports that fail to render will not be updated. You can
create a <a href="https://github.com/NOAA-EDAB/esp_data_aggregation/blob/main/R-scripts/render%20dev%20report%20with%20errors.R" class="external-link">report
generation script that integrates error logging code</a> to output
information about the reports that failed.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/atyrell3" class="external-link">Abigail Tyrell</a>, <a href="https://github.com/stephanie-owen" class="external-link">Stephanie Owen</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
